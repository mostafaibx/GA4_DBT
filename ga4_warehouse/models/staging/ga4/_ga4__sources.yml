version: 2

sources:
  - name: ga4_export
    description: "Google Analytics 4 BigQuery export data"
    database: "{{ var('ga4_project') }}"
    schema: "{{ var('ga4_export_dataset') }}"
    
    tables:
      - name: events_*
        description: "Daily GA4 event export tables containing all user interactions"
        meta:
          contains_pii: true
        columns:
          - name: event_date
            description: "Date when the event was logged (YYYYMMDD format)"
            tests:
              - not_null
          
          - name: event_timestamp
            description: "Unix timestamp in microseconds when the event was logged"
            tests:
              - not_null
          
          - name: event_name
            description: "Name of the event"
            tests:
              - not_null
          
          - name: event_params
            description: "Array of event parameters"
          
          - name: event_previous_timestamp
            description: "Unix timestamp of the previous event"
          
          - name: event_value_in_usd
            description: "Event value in USD"
          
          - name: event_bundle_sequence_id
            description: "Sequential ID of the bundle in which these events were uploaded"
          
          - name: event_server_timestamp_offset
            description: "Offset between collection time and upload time in micros"
          
          - name: user_id
            description: "User ID set via the setUserId API"
          
          - name: user_pseudo_id
            description: "Pseudonymous identifier for the user"
            tests:
              - not_null
          
          - name: user_properties
            description: "Array of user properties"
          
          - name: user_first_touch_timestamp
            description: "Unix timestamp of the user's first app open or site visit"
          
          - name: user_ltv
            description: "User lifetime value"
          
          - name: device
            description: "Device information"
          
          - name: geo
            description: "Geographic information"
          
          - name: app_info
            description: "Application information"
          
          - name: traffic_source
            description: "Traffic source information"
          
          - name: stream_id
            description: "Data stream ID"
          
          - name: platform
            description: "Platform where the event was logged (WEB, IOS, ANDROID)"
          
          - name: event_dimensions
            description: "Event-scoped custom dimensions"
          
          - name: ecommerce
            description: "E-commerce information"
          
          - name: items
            description: "Array of items associated with the event"

      - name: events_intraday_*
        description: "Intraday GA4 event tables (refreshed throughout the day)"
        meta:
          contains_pii: true
        columns:
          - name: event_date
            description: "Date when the event was logged (YYYYMMDD format)"
          - name: event_timestamp
            description: "Unix timestamp in microseconds when the event was logged"
          - name: event_name
            description: "Name of the event"
          - name: user_pseudo_id
            description: "Pseudonymous identifier for the user"

      - name: pseudonymous_users_*
        description: "Daily snapshot of user data"
        meta:
          contains_pii: true
        columns:
          - name: pseudo_user_id
            description: "Pseudonymous identifier for the user"
            tests:
              - not_null
              - unique
          
          - name: stream_id
            description: "Data stream ID"
          
          - name: user_id
            description: "User ID set via the setUserId API"
          
          - name: first_touch_timestamp
            description: "Unix timestamp of the user's first app open or site visit"
          
          - name: last_touch_timestamp
            description: "Unix timestamp of the user's last interaction"
          
          - name: user_properties
            description: "Array of user properties"
          
          - name: predictions
            description: "Predictive metrics for the user"
          
          - name: audiences
            description: "List of audiences the user belongs to"
          
          - name: user_ltv
            description: "User lifetime value"